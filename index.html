<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Mini Padlet Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f5f5fb;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 960px;
      padding: 24px 16px 48px;
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
    }

    .board-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: #222;
    }

    .board-subtitle {
      font-size: 0.9rem;
      color: #666;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      background: #ecebff;
      color: #4b4acb;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
    }

    .card + .card {
      margin-top: 16px;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .form-row > * {
      flex: 1 1 120px;
    }

    label {
      font-size: 0.85rem;
      color: #555;
      display: block;
      margin-bottom: 4px;
    }

    input[type="text"],
    textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #d4d4f0;
      padding: 8px 10px;
      font-size: 0.9rem;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease;
      background: #fafaff;
    }

    input[type="text"]:focus,
    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.15);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 200px;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.35);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-primary:active,
    .btn-secondary:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .posts-wrapper {
      margin-top: 18px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }

    .post-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 3px 12px rgba(15, 23, 42, 0.06);
      position: relative;
      overflow: hidden;
      border-left: 4px solid #a5b4fc;
    }

    .post-name {
      font-weight: 600;
      font-size: 0.9rem;
      color: #111827;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .post-time {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .post-text {
      font-size: 0.9rem;
      color: #374151;
      white-space: pre-wrap;
      margin-top: 2px;
    }

    .no-posts {
      margin-top: 10px;
      font-size: 0.85rem;
      color: #9ca3af;
      text-align: center;
    }

    .status {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #6b7280;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.12);
    }

    @media (max-width: 600px) {
      .board-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î -->
    <div class="board-header">
      <div>
        <div class="board-title">STSU Idea Wall</div>
        <div class="board-subtitle">
          ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô üß†üí¨
        </div>
      </div>
      <span class="badge">Mini Padlet</span>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå -->
    <div class="card">
      <form id="postForm">
        <div class="form-row">
          <div>
            <label for="name">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
            <input
              type="text"
              id="name"
              placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 12"
              required
            />
          </div>
          <div>
            <label for="topic">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
            <input
              type="text"
              id="topic"
              placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
            />
          </div>
        </div>

        <div>
          <label for="message">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î</label>
          <textarea
            id="message"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÅ‡∏ä‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
            required
          ></textarea>
        </div>

        <div class="actions">
          <button type="reset" class="btn-secondary">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
          <button type="submit" class="btn-primary">
            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå
          </button>
        </div>

        <div id="status" class="status">
          <span class="status-dot"></span>
          <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏≠‡∏£‡πå‡∏î...</span>
        </div>
      </form>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå -->
    <div class="card" style="margin-top: 16px">
      <div style="font-weight: 600; margin-bottom: 8px; color: #111827">
        ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ö‡∏ô‡∏ö‡∏≠‡∏£‡πå‡∏î
      </div>
      <div id="posts" class="posts-wrapper"></div>
      <div id="noPosts" class="no-posts" style="display: none">
        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ô‡∏µ‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏π‡πÄ‡∏•‡∏¢ ‚ú®
      </div>
    </div>
  </div>

  <!-- Firebase + Logic -->
  <script type="module">
    // ----------------------------
    // 1) Import Firebase (‡πÅ‡∏ö‡∏ö v9 modular)
    // ----------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      onSnapshot,
      query,
      orderBy,
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // ----------------------------
    // 2) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
    //    üëâ ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏õ copy ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Project Settings > General (Your Apps)
    // ----------------------------
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ field ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô storageBucket ‡∏Å‡πá‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£
    };

    // ----------------------------
    // 3) ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase & Firestore
    // ----------------------------
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô collection ‡∏ä‡∏∑‡πà‡∏≠ "posts"
    const postsCol = collection(db, "posts");

    // ----------------------------
    // 4) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°
    // ----------------------------
    const postForm = document.getElementById("postForm");
    const nameInput = document.getElementById("name");
    const topicInput = document.getElementById("topic");
    const messageInput = document.getElementById("message");
    const postsEl = document.getElementById("posts");
    const noPostsEl = document.getElementById("noPosts");
    const statusEl = document.getElementById("status");

    function setStatus(text, isOnline = true) {
      statusEl.querySelector("span:nth-child(2)").textContent = text;
      const dot = statusEl.querySelector(".status-dot");
      if (isOnline) {
        dot.style.background = "#10b981";
        dot.style.boxShadow = "0 0 0 4px rgba(16,185,129,0.12)";
      } else {
        dot.style.background = "#f97316";
        dot.style.boxShadow = "0 0 0 4px rgba(249,115,22,0.12)";
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á timestamp ‚Üí string ‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
    function formatDate(ts) {
      if (!ts) return "";
      const date = ts.toDate();
      const d = date.toLocaleDateString("th-TH", {
        day: "2-digit",
        month: "short",
      });
      const t = date.toLocaleTimeString("th-TH", {
        hour: "2-digit",
        minute: "2-digit",
      });
      return `${d} ‚Ä¢ ${t}`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå 1 ‡∏≠‡∏±‡∏ô
    function createPostElement(doc) {
      const data = doc.data();
      const el = document.createElement("div");
      el.className = "post-card";

      const name = data.name || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
      const topic = data.topic || "";
      const text = data.message || "";
      const timeStr = formatDate(data.createdAt);

      el.innerHTML = `
        <div class="post-name">
          <span>${escapeHtml(name)}</span>
          <span class="post-time">${timeStr}</span>
        </div>
        ${
          topic
            ? `<div style="font-size:0.8rem;color:#4b5563;margin-bottom:4px;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ${escapeHtml(
                topic
              )}</div>`
            : ""
        }
        <div class="post-text">${escapeHtml(text)}</div>
      `;

      return el;
    }

    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // ----------------------------
    // 5) Listener real-time: ‡∏î‡∏∂‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤
    // ----------------------------
    setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏≠‡∏£‡πå‡∏î...");

    const q = query(postsCol, orderBy("createdAt", "desc"));
    onSnapshot(
      q,
      (snapshot) => {
        postsEl.innerHTML = "";
        if (snapshot.empty) {
          noPostsEl.style.display = "block";
        } else {
          noPostsEl.style.display = "none";
          snapshot.forEach((doc) => {
            const el = createPostElement(doc);
            postsEl.appendChild(el);
          });
        }
        setStatus("‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
      },
      (error) => {
        console.error("listen error:", error);
        setStatus("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", false);
      }
    );

    // ----------------------------
    // 6) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î submit ‡∏ü‡∏≠‡∏£‡πå‡∏° ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Firestore
    // ----------------------------
    postForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const topic = topicInput.value.trim();
      const message = messageInput.value.trim();

      if (!name || !message) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üôÇ");
        return;
      }

      try {
        setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå...");
        await addDoc(postsCol, {
          name,
          topic,
          message,
          createdAt: serverTimestamp(),
        });

        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà
        messageInput.value = "";
        // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ uncomment ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
        // topicInput.value = "";
        messageInput.focus();
        setStatus("‡∏™‡πà‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      } catch (err) {
        console.error(err);
        setStatus("‡∏™‡πà‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", false);
        alert("‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
      }
    });
  </script>
</body>
</html>
